---
title: "Bolivia"
output: html_document
---

```{r, include=FALSE}
library(dygraphs)
library(tidyverse)
library(zoo)
library(rio)
library(tidyverse)
library(magrittr)
library(janitor)
library(anytime)

dyUnzoom <-function(dygraph) {
dyPlugin(
  dygraph = dygraph,
  name = "Unzoom",
  path = system.file("plugins/unzoom.js", package = "dygraphs")
)
}
dyCrosshair <- function(dygraph, 
                        direction = c("both", "horizontal", "vertical")) {
  dyPlugin(
    dygraph = dygraph,
    name = "Crosshair",
    path = system.file("plugins/crosshair.js", 
                       package = "dygraphs"),
    options = list(direction = match.arg(direction))
  )
}
fun_fecha <-function(from, to, by, each) {
  rep(seq(anydate(from),
          anydate(to),
          by = by), each = each)
}
fun_excel <-function(file, range, col_names, from, to, by, each) {
  
  data <- 
    rio::import(
      file,
      setclass = "tbl_df",
      range = range,
      col_names = col_names,
      .name_repair = "unique_quiet") %!>%
    remove_empty(c("rows", "cols")) %!>%
    replace(is.na(.), 0)
  data %<>%
    pivot_longer(!...1) %<>%
    pivot_wider(names_from = "...1",
                values_from = "value") %<>%
    dplyr::select(-name)
  
  fecha <- fun_fecha(from,to,by,each)
  data <- cbind(fecha, data) 
  data <- as_tibble(data)
  
}

file <- "C:/Users/Mauro/Desktop/bases_de_datos/bolivia/ine/estadistica_economica/cuentas_nacionales/pib_anual/oferta_final_demanda_final/03.01.02.xlsx"

#IMPORTAR DATOS DE EXCEL
range <- "B12:AJ19"
col_names <- FALSE
#FORMATO FECHA
from <- "31Dec1989"
to <- "31Dec2022"
by <- "year"
each <- 1

excel <- 
  fun_excel(file, range, col_names, from, to, by, each)

excel %!>% 
  read.zoo(excel, FUN = as.yearmon) %!>% 
  as.ts(excel)

pib <- excel %!>% 
  select(fecha, `PRODUCTO  INTERNO  BRUTO`) #PIB

```
```{r, echo=FALSE, out.width="50%", out.height="50%"}
dygraph(pib, main = "Crecimiento Real Producto Interno Bruto<br><small>En Porcentaje (%)</small>") %!>% 
  dySeries("PRODUCTO  INTERNO  BRUTO", label = "Producto Interno Bruto") %!>% 
  dyLegend(width = 250) %!>% 
  dyOptions(stackedGraph = TRUE, axisLineColor = "#98918B", strokePattern="dotted") %!>%
  dyAxis("x", drawGrid = FALSE) %>%
  dyAxis("y",  axisLabelFormatter = "function(v){return (v*1).toFixed(0) + '%'}",
         gridLineColor = "#4a4a4a", 
         valueRange = c(-9,9),
         ticker = "function(min, max, pixels, opts, dygraph, vals) {
          
          return [{v:-9, label:-9}, {v:-6, label:-6},{v:-3, label:-3},{v:0, label:0},
                  {v:3, label:3}, {v:6, label:6}, {v:9, label:9}];
        }") %!>% 
  dyCrosshair(direction = "vertical") %!>% 
  dyRangeSelector(height = 20, strokeColor = "") %!>% 
  dyUnzoom()
```