---
title: "Bolivia"
output: html_document
---

```{r, include=FALSE}
library(dygraphs)
library(tidyverse)
library(zoo)
library(rio)
library(tidyverse)
library(magrittr)
library(janitor)
library(anytime)

dyUnzoom <-function(dygraph) {
dyPlugin(
  dygraph = dygraph,
  name = "Unzoom",
  path = system.file("plugins/unzoom.js", package = "dygraphs")
)
}
dyCrosshair <- function(dygraph, 
                        direction = c("both", "horizontal", "vertical")) {
  dyPlugin(
    dygraph = dygraph,
    name = "Crosshair",
    path = system.file("plugins/crosshair.js", 
                       package = "dygraphs"),
    options = list(direction = match.arg(direction))
  )
}
fun_fecha <-function(from, to, by, each) {
  rep(seq(anydate(from),
          anydate(to),
          by = by), each = each)
}
fun_excel <-function(file, range, col_names, from, to, by, each) {
  
  data <- 
    rio::import(
      file,
      setclass = "tbl_df",
      range = range,
      col_names = col_names,
      .name_repair = "unique_quiet") %!>%
    remove_empty(c("rows", "cols")) %!>%
    replace(is.na(.), 0)
  data %<>%
    pivot_longer(!...1) %<>%
    pivot_wider(names_from = "...1",
                values_from = "value") %<>%
    dplyr::select(-name)
  
  fecha <- fun_fecha(from,to,by,each)
  data <- cbind(fecha, data) 
  data <- as_tibble(data)
  
}

file <- "C:/Users/Mauro/Desktop/bases_de_datos/bolivia/ine/estadistica_economica/cuentas_nacionales/pib_anual/oferta_final_demanda_final/03.01.02.xlsx"

#IMPORTAR DATOS DE EXCEL
range <- "B12:AJ19"
col_names <- FALSE
#FORMATO FECHA
from <- "31Dec1989"
to <- "31Dec2022"
by <- "year"
each <- 1

excel <- 
  fun_excel(file, range, col_names, from, to, by, each)

excel %!>% 
  read.zoo(excel, FUN = as.yearmon) %!>% 
  as.ts(excel)

pib <- excel %!>% 
  select(fecha, `PRODUCTO  INTERNO  BRUTO`) #PIB

```

<div class="row">
```{r, fig.width= 6, fig.height= 4.5, echo=FALSE }
dygraph(pib, main = "Crecimiento Real Producto Interno Bruto<br><small>En Porcentaje (%)</small>") %!>% 
  dySeries("PRODUCTO  INTERNO  BRUTO", label = "Producto Interno Bruto") %!>% 
  dyLegend() %!>% 
  dyOptions(stackedGraph = TRUE, axisLineColor = "#98918B", strokePattern="dotted") %!>%
  dyAxis("x", drawGrid = FALSE) %>%
  dyAxis("y",
         gridLineColor = "#4a4a4a",
      valueFormatter = "function(d){return Math.round(d*100)/1e2 + '%'}",
    axisLabelFormatter = "function(d){return Math.round(d*100)/1e2 + '%'}") %!>% 
  dyCrosshair(direction = "vertical") %!>% 
  dyRangeSelector(height = 20, strokeColor = "") %!>% 
  dyUnzoom()
```
</div>
<div class="row">
<div class="col-lg-6">
```{r dygraph1,fig.width= 6, fig.height= 4.5, warning = FALSE, echo=FALSE, out.width="99%"}
library(dygraphs)
lungDeaths <- cbind(mdeaths, fdeaths)
dygraph(lungDeaths) %>%
  dySeries("mdeaths", label = "Male") %>%
  dySeries("fdeaths", label = "Female") %>%
  dyOptions(stackedGraph = TRUE) %>%
  dyRangeSelector(height = 20)
```

</div>
<div class="col-lg-6">
```{r dygraph2,fig.width= 6, fig.height= 4.5, warning = FALSE, echo=FALSE, out.width="99%"}
library(dygraphs)
lungDeaths <- cbind(mdeaths, fdeaths)
dygraph(lungDeaths, main = "Crecimiento Real Producto Interno Bruto<br><small>En Porcentaje (%)</small>")%!>% 
  dyCrosshair(direction = "vertical") %!>% 
dyRangeSelector(height = 20, strokeColor = "") 

```
</div>
</div>

