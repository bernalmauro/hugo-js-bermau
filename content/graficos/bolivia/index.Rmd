---
title: "Bolivia"
output: html_document
---

```{r warning = FALSE, include=FALSE}
library(dygraphs) 
library(tidyverse)
library(zoo)
library(rio)
library(tidyverse)
library(magrittr)
library(janitor)
library(anytime)
library(knitr)
library(details)
library(DT)
library(shiny)
library(plotly)
library(bookdown)
library(rmarkdown)
library(htmltools)
library(xaringanExtra)
library(tibbletime)
library(unikn)
library(scales)
library(ggnewscale)
library(patchwork)


#LABURO GGPLOT WRAP
fun_fecha <-function(from, to, by, each) {
  rep(seq(anydate(from),
          anydate(to),
          by = by), each = each)
}
pal <- function(num) {
  usecol(c("#065a25", "#f2f419", "#f41919"),
         n = num)
}
theme_wrap <- function() {
  theme(
    axis.line.x = element_line("#98918B"),
    axis.line.y = element_line("#98918B"),
    axis.ticks = element_line(color = "#98918B"),
    
    panel.background = element_rect(fill = "#1d1d1d", colour = "#1d1d1d"),
    panel.grid.major = element_line(color = "#1d1d1d"),
    panel.grid.minor = element_line(color = "#1d1d1d"),
    panel.grid.major.y = element_line(color = "#e3e3e3", linetype = "dotted"),
    panel.grid.major.x = element_line(color = "#4a4a4a", linetype = "dotted"),
    
    strip.background = element_rect(fill = "#98918B", color = "#98918B"),
    strip.text = element_text(color = "black"),
    strip.placement = 'outside',
    strip.switch.pad.wrap = unit(10, "mm"),
    
    plot.background = element_rect(fill = "#1d1d1d", colour = "#1d1d1d"),
    legend.box.background = element_blank(),
    legend.background = element_blank(),
    legend.key = element_blank(),
    legend.title=element_blank(),
    
    axis.text = element_text(color = "#e3e3e3",size = rel(1)),
    axis.title = element_blank(),
    text = element_text(color = "#e3e3e3",family = "Constantia"),
    
    plot.subtitle = element_text(margin = margin(0, 0, 0.5, 0, "cm")),
    plot.caption = element_text(margin = margin(0.5, 0, 0, 0, "cm"))
  )
}
theme_annotations <- function() {
  theme(
    title = element_text(
      family = "Constantia",
      face = "plain",
      colour = "#e3e3e3",
      size = rel(1),
      inherit.blank = FALSE),
    plot.title = element_text(hjust = 1, vjust = 0),
    plot.subtitle = element_text(hjust = 1,vjust = 0),
    plot.background = element_rect(fill = "#1d1d1d", color = "#1d1d1d"),
    complete=TRUE)
}

#BANCO CENTRAL####
file <- "C:/Users/Mauro/Desktop/bases_de_datos/bolivia/banco_central/4.mensual/1.monetario/01.base_monetaria.xlsx"
#IMPORTAR DATOS DE EXCEL
range <- "D24:T312"
col_names <- FALSE
#FORMATO FECHA

data <- 
  rio::import(
    file,
    setclass = "tbl_df",
    range = range,
    col_names = col_names,
    .name_repair = "unique_quiet") %!>%
  remove_empty(c("rows", "cols")) %!>%
  replace(is.na(.), 0)
data
colnames(data) <- c(

  "Reservas Internacionales Netas",
  "Reservas Internacionales Brutas",
  "Obligaciones Externas a Corto Plazo",
  "Crédito Neto al Sector Público",
  "Total Crédito a Bancos",
  "BCL",
  "BE Y OEF",
  "Títulos Regulación Monetaria",
  "SRD",
  "Otras Cuentas Netas",
  "Origen Base Monetaria",
  "Billetes y Monedas en poder del Público",
  "Reservas Bancarias en Moneda Nacional",
  "Reservas Bancarias en UFV",
  "Reservas Bancarias en Moneda Extranjera",
  "Total Reservas Bancarias",
  "Destino Base Monetaria"
  )
names_data <- names(data)

from <- "31Dec1998"
to <- "31Dec2022"
by <- "month"
each <- 1

fecha <- fun_fecha(from,to,by,each)
data <- cbind(fecha, data) 
data <- as_tibble(data)

excel <- data %>%
  select(fecha, 
         `Reservas Internacionales Netas`,
         `Crédito Neto al Sector Público`,
         `Total Crédito a Bancos`,
         `Títulos Regulación Monetaria`,
         `Otras Cuentas Netas`,
         `Origen Base Monetaria`,
         `Billetes y Monedas en poder del Público`,
         `Total Reservas Bancarias`,
         `Destino Base Monetaria`) 

hoja_excel <- as_tbl_time(excel, index = fecha) #FORMATO DATE FLEXIBLE
hoja_excel_ <- as_period(hoja_excel, period = "year", side = "end", include_endpoints = FALSE)

var_col <- colnames(excel)[-c(1,7,10)]

line_col <- 
  hoja_excel_ %!>%
  pivot_longer(
    cols = c(`Origen Base Monetaria`, `Destino Base Monetaria`),
    names_to = "var_line",
    values_to = "value_line"
  ) %!>%
  pivot_longer(cols = any_of(var_col),
               names_to = "var_col",
               values_to = "value_col") %!>%
  dplyr::filter(
    var_line %in% "Origen Base Monetaria" &
      var_col %in% c("Reservas Internacionales Netas",
                     "Crédito Neto al Sector Público",
                     "Total Crédito a Bancos",
                     "Títulos Regulación Monetaria",
                     "Otras Cuentas Netas") |
      var_line %in% "Destino Base Monetaria" &
      var_col %in% c(
        "Billetes y Monedas en poder del Público",
        "Total Reservas Bancarias"
      )
  ) %!>%
  mutate(across(where(is.numeric),  ~ . / 1000),
         across(where(is.character), as_factor),
         new_id=cur_group_id(),
         .by = var_line) %!>% 
  mutate(across(where(is.character), as_factor))



origen_g <- 
  line_col %!>% 
  dplyr::filter(
    new_id==1) 

destino_g <- 
  line_col %!>% 
  dplyr::filter(
    new_id==2) 


pal_fill <- 
  origen_g %!>%
  pull(var_col) %!>%
  unique() %!>% 
  length() %!>% 
  pal()

pal_col <- 
  origen_g %!>%
  pull(var_col) %!>%
  unique() %!>% 
  length() %!>% 
  pal()

p1 <-    
  ggplot(line_col,aes(fecha,value_col))+
  geom_col(destino_g,mapping=aes(fill = var_col),
           color="#1d1d1d")+ 
  scale_fill_manual(values = pal_col)+
  scale_y_continuous(labels = comma_format()) +
  new_scale_fill()+
  geom_col(origen_g,mapping=aes(fill = var_col),
           color="#1d1d1d") +
  scale_fill_manual(values = pal_fill)+
  facet_wrap(vars(var_line))+theme_wrap()
p2 <-    
  ggplot(destino_g,aes(fecha,value_col))+
  geom_line(destino_g,mapping=aes(color = var_col),
            linewidth=1)+ 
  scale_color_manual(values = pal_col)+
  scale_y_continuous(labels = comma_format()) +
  guides(color = "none")+
  new_scale_color()+
    geom_line(origen_g,mapping=aes(color = var_col),
            linewidth=1)+
  scale_color_manual(values = pal_fill)+
  facet_wrap(vars(var_line))+
  guides(color = "none")+theme_wrap()
p2
title <-"ORIGEN Y DESTINO DE LA BASE MONETARIA, 1998 - 2022"
subtitle <-"(En millones de bolivianos)"
caption = "Fuente: Elaboración propia en base al BCB\nBernal Mauricio / bernalmauricio.com"
anotattion <- plot_annotation(title = title,subtitle = subtitle,
                              caption = caption,theme = theme_annotations())

grafico <- (p1/p2)+plot_layout(guides = "collect")&anotattion

knitr::opts_chunk$set(echo = TRUE, error = TRUE)
```
### Autoridad de Supervisión del Sistema Financiero (ASFI)
{{< tabs tabTotal="14">}}
{{< tab tabName="Estructura de Activos" >}}
```{r knitr-activos, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/activos/Cartera Neta_Activo.png", error = FALSE)
knitr::include_graphics("/images/asfi/activos/Disponibilidades_Activos.png", error = FALSE)
```
{{< /tab >}}
{{< tab tabName="Calidad de Cartera" >}}
```{r knitr-calidad, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/calidad/A Cartera con requerimiento de previsión.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/B Cartera con requerimiento de previsión.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/C Cartera con requerimiento de previsión del 20_.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/Cartera Reprog. o Reestruct. Vencida y Ejec._Cartera Reprog. o Reestruct. Total.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/Cartera reprogramada o reestructurada vigente_Cartera vigente total.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/Cartera reprogramada o reestructurada_Cartera.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/Cartera Vencida Total+Ejecución _Total Cartera.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/Cartera Vigente Total_Cartera.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/D Cartera con requerimiento de previsión del 50_.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/E Cartera con requerimiento de previsión del 80_.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/F Cartera con requerimiento de previsión del 100_.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/Prev. Cartera Incobrable_Cartera.png", error = FALSE)
knitr::include_graphics("/images/asfi/calidad/Prod. Financieros Devengados por Cobrar CarteraCartera.png", error = FALSE)
```
{{< /tab >}}
{{< tab tabName="Estructura Financiera" >}} 
```{r knitr-esfinanciera, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/esfinanciera/Activo improductivo_Patrimonio.png", error = FALSE)
knitr::include_graphics("/images/asfi/esfinanciera/Activo Productivo_Activo+Contingente.png", error = FALSE)
knitr::include_graphics("/images/asfi/esfinanciera/Activo Productivo-Pasivo con Costo_Pasivo con Costo.png", error = FALSE)
knitr::include_graphics("/images/asfi/esfinanciera/Pasivo con Costo_Pasivo+Contingente.png", error = FALSE )
```
{{< /tab >}}
{{< tab tabName="Estructura de Gastos de Administración">}}
```{r knitr-gastos, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/gastos/Deprec.y Amortizaciones_Gastos de Administración.png", error = FALSE)
knitr::include_graphics("/images/asfi/gastos/Gastos de Administración_Total Egresos.png", error = FALSE)
knitr::include_graphics("/images/asfi/gastos/Gastos de Personal_Gastos de Administración.png", error = FALSE)
knitr::include_graphics("/images/asfi/gastos/Otros Gastos Administración_Gastos de Administración.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Ingresos y Gastos Financieros">}}
```{r knitr-ingresos, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/ingresos/cargosbcb.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Int. Depósitos Caja de Ahorro_Oblig. Púb. Ctas. Ahorro.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Int. Depósitos Púb. a Plazo_Depósitos Púb. a Plazo.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Int. Oblig. con Emp. públicas_Oblig. cemp. públicas.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Int. Oblig. Púb. a la Vista_Oblig. Púb. a la Vista.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Int. penales Cartera en Ejecución Total_Productos cartera en Ejecución.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Int. penales Cartera Vencida Total y en Ejecución Total_Productos cartera Vencida Total y en Ejecución.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Int. penales Cartera Vencida Total_Productos cartera vencida total.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Productos por Cartera Reprog. y Reestruct. Vencida y en Ejec._Cartera Reprog. y Reestruct. Vencida.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Productos por Cartera Reprog. y Reestruct. Vigente_Cartera Reprog. y Reestruct. Vigente.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Productos por Cartera Vencida y en Ejecución_Cartera Vencida y en Ejecución.png", error = FALSE)
knitr::include_graphics("/images/asfi/ingresos/Productos por Cartera Vigente_Cartera Vigente.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Liquidez">}}
```{r knitr-liquidez, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/liquidez/Activos líquidos_Pasivos de corto plazo.png", error = FALSE)
knitr::include_graphics("/images/asfi/liquidez/Disponib.+Inv.Temp._Oblig.a Corto Plazo.png", error = FALSE)
knitr::include_graphics("/images/asfi/liquidez/Disponib.+Inv.Temp._Pasivo.png", error = FALSE)
knitr::include_graphics("/images/asfi/liquidez/Disponibilidades_Oblig.a Corto Plazo.png", error = FALSE)
knitr::include_graphics("/images/asfi/liquidez/Disponibilidades+Inv.Temporarias_Activo.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Estructura de Obligaciones">}}
```{r knitr-obligaciones, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/obligaciones/Días de permanencia de los depósitos a plazo fijo.png", error = FALSE)
knitr::include_graphics("/images/asfi/obligaciones/Oblig. Personas Jurídicas e Institucionales_Total Oblig. Público.png", error = FALSE)
knitr::include_graphics("/images/asfi/obligaciones/Oblig. Personas Naturales_Total Oblig. Público.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Estructura de Pasivos">}}
```{r knitr-pasivos, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/pasivos/Oblig. con Bancos y Ent. Fin._Pasivo+Patrimonio.png", error = FALSE)
knitr::include_graphics("/images/asfi/pasivos/Oblig. con el Público y con Empresas Públicas_Pasivo+Patrimonio.png", error = FALSE)
knitr::include_graphics("/images/asfi/pasivos/Oblig. con el_ PúblicoPasivo+Patrimonio.png", error = FALSE)
knitr::include_graphics("/images/asfi/pasivos/Oblig. Subordinadas_Pasivo+Patrimonio.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Ratios de Eficiencia (anualizado)">}}
```{r knitr-ratios, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/ratios/Gastos de Administración_(Activo+Contingente).png", error = FALSE)
knitr::include_graphics("/images/asfi/ratios/Gastos de Administración_(Cartera+Contingente).png", error = FALSE)
knitr::include_graphics("/images/asfi/ratios/Gastos de Administración_Activo Productivo Promedio neto de Contingente.png", error = FALSE)
knitr::include_graphics("/images/asfi/ratios/Gastos de Administración_Depósito.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Ratios de Eficiencia (anualizado)">}}
```{r knitr-rentabilidad, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/rentabilidad/Resultado de Operación Bruto_(Activo+Contingente).png", error = FALSE)
knitr::include_graphics("/images/asfi/rentabilidad/Resultado de operación después de Incobrables_(Activo + Contingente).png", error = FALSE)
knitr::include_graphics("/images/asfi/rentabilidad/Resultado de Operación Neto Antes de Impuestos_(Activo+Contingente).png", error = FALSE)
knitr::include_graphics("/images/asfi/rentabilidad/Resultado de Operación Neto_(Activo + Contingente).png", error = FALSE)
knitr::include_graphics("/images/asfi/rentabilidad/Resultado Financiero Bruto_(Activo + Contingente).png", error = FALSE)
knitr::include_graphics("/images/asfi/rentabilidad/Resultado Neto de la Gestión_(Activo+Contingente) (ROA).png", error = FALSE)
knitr::include_graphics("/images/asfi/rentabilidad/Resultado Neto de la Gestión_Patrimonio (ROE.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Resultados (anualizado)">}}
```{r knitr-resultados, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/resultados/Ajustes netos por inflación y por diferencias de cambio_Activo+Conting.png", error = FALSE)
knitr::include_graphics("/images/asfi/resultados/Cargos por Incob. Netos de Recuper._Activo+Conting..png", error = FALSE)
knitr::include_graphics("/images/asfi/resultados/Deprec. y Desval. Bienes de Uso_Bienes de Uso-Terrenos.png", error = FALSE)
knitr::include_graphics("/images/asfi/resultados/Gastos de Administración_Activo+Contingente.png", error = FALSE)
knitr::include_graphics("/images/asfi/resultados/Gastos Financieros_Activo+Contingente.png", error = FALSE)
knitr::include_graphics("/images/asfi/resultados/Gastos Financieros_Pasivos con costo promedio.png", error = FALSE)
knitr::include_graphics("/images/asfi/resultados/Ing. Extraord. y de Gest. Ant. Netos_Activo+Conting..png", error = FALSE)
knitr::include_graphics("/images/asfi/resultados/Ingresos Financieros_Activo+Contingente.png", error = FALSE)
knitr::include_graphics("/images/asfi/resultados/Otros Ingresos Operativos Netos_Activo+Contingente.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Solvencia">}}
```{r knitr-solvencia, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/solvencia/Cartera Vencida + Ejec. reprog. o reestruct._Patrimonio.png", error = FALSE)
knitr::include_graphics("/images/asfi/solvencia/Cartera Vencida Total + Eje.Total - Prev_Patrimonio.png", error = FALSE)
knitr::include_graphics("/images/asfi/solvencia/Cartera Vencida Total + Ejecución Total_Patrimonio.png", error = FALSE)
knitr::include_graphics("/images/asfi/solvencia/Coeficiente de Adecuación Patrimonial.png", error = FALSE)
knitr::include_graphics("/images/asfi/solvencia/Patrimonio_Activo.png", error = FALSE)
knitr::include_graphics("/images/asfi/solvencia/Patrimonio_Activo+Contingte..png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Cálculo Spread Efectivo (anualizado)">}}
```{r knitr-spread, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/spread/1.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread/2.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread/3.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread/4.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread/5.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread/6.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread/7.png", error = FALSE)
```
{{< /tab >}} 
{{< tab tabName="Utillización Spread Efectivo">}}
```{r knitr-spread-efectivo, out.width='100%', echo=FALSE}
knitr::include_graphics("/images/asfi/spread-efectivo/Ajustes netos por inflación y por diferencia de cambio.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread-efectivo/Gastos administrativos.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread-efectivo/Incobrabilidad.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread-efectivo/Resultados extraordinarios.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread-efectivo/Resultados gestiones anteriores.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread-efectivo/SPREAD EFECTIVO.png", error = FALSE)
knitr::include_graphics("/images/asfi/spread-efectivo/UTILIDAD NETA.png", error = FALSE)
```
{{< /tab >}} 
{{< /tabs >}}


### Banco Central de Bolivia (BCB)
{{< tabs tabTotal="14">}}
{{< tab tabName="Base Monetaria">}}
```{r base_monetaria,warning = FALSE, fig.width = 12,fig.height = 7,echo=FALSE}
grafico
```

{{< /tab>}}

{{< tab tabName="Calidad de Cartera" >}}


{{< /tab >}}
{{< tab tabName="Estructura Financiera" >}} 

{{< /tab >}}
{{< tab tabName="Estructura de Gastos de Administración">}}

{{< /tab >}} 
{{< tab tabName="Ingresos y Gastos Financieros">}}

{{< /tab >}} 
{{< tab tabName="Liquidez">}}

{{< /tab >}} 
{{< tab tabName="Estructura de Obligaciones">}}

{{< /tab >}} 
{{< tab tabName="Estructura de Pasivos">}}

{{< /tab >}} 
{{< tab tabName="Ratios de Eficiencia (anualizado)">}}

{{< /tab >}} 
{{< tab tabName="Ratios de Eficiencia (anualizado)">}}

{{< /tab >}} 
{{< tab tabName="Resultados (anualizado)">}}

{{< /tab >}} 
{{< tab tabName="Solvencia">}}

{{< /tab >}} 
{{< tab tabName="Cálculo Spread Efectivo (anualizado)">}}

{{< /tab >}} 
{{< tab tabName="Utillización Spread Efectivo">}}

{{< /tab >}} 
{{< /tabs >}} 
